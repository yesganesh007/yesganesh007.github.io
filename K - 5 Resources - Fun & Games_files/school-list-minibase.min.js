// MINIBASE SCHOOL LIST MANAGEMENT
// AUTHOR: BRENTON KELLY - CREATIVE DEVELOPMENT MANAGER - BLACKBOARD, INC.
// VERSION: 4.4.17

!function(a){a.schoolListMinibase=function(b){function e(){try{return sessionStorage.setItem("test","1"),sessionStorage.removeItem("test"),!0}catch(a){return!1}}function f(b){var d=[],e="",f="",g="",h="",i="",j=a(b).find("#module-content-"+c.miniBaseModuleInstanceID+" .sw-flex-table").length?"table":"list";return"table"==j?a(b).find("#module-content-"+c.miniBaseModuleInstanceID+" .sw-flex-table tr:not(.sw-flex-column-heading)").each(function(){a("> td",this).each(function(){switch(a(this).index()){case 0:e=a.trim(a(this).text());break;case 1:f=a.trim(a(this).text());break;case 2:g=a.trim(a(this).text());break;case 3:h=a.trim(a(this).text());break;case 4:i=a.trim(a(this).text())}}),d.push({schoolName:e,schoolType:f,schoolUrl:g,schoolAlias:h,schoolVisible:i})}):"list"==j&&a(b).find("#module-content-"+c.miniBaseModuleInstanceID+" .sw-flex-list .sw-flex-item-group").each(function(){a("> .sw-flex-item-list > .sw-flex-item",this).each(function(){switch(a("> .sw-flex-item-label",this).remove(),a(this).index()){case 0:e=a.trim(a(this).text());break;case 1:f=a.trim(a(this).text());break;case 2:g=a.trim(a(this).text());break;case 3:h=a.trim(a(this).text());break;case 4:i=a.trim(a(this).text())}}),d.push({schoolName:e,schoolType:f,schoolUrl:g,schoolAlias:h,schoolVisible:i})}),d}function g(){a(".sw-mystart-dropdown.schoollist .sw-dropdown-list li a").keydown(function(b){if(b.stopPropagation(),38==b.keyCode)b.preventDefault(),0==a(this).parent("li").prev("li").length?a(this).parents("ul").parents(".sw-mystart-nav").length>0?a(this).parents("ul").parents(".sw-mystart-nav").focus():a(this).parents("ul").prev(".sw-mystart-nav").focus():a(this).parent("li").prev("li").find("a").first().focus();else if(40==b.keyCode)b.preventDefault(),0==a(this).parent("li").next("li").length?a(this).parents("ul").parents(".sw-mystart-nav").length>0?a(this).parents("ul").parents(".sw-mystart-nav").focus():a(this).parents("ul").prev(".sw-mystart-nav").focus():(a(this).parent("li").next("li").find("a").first().attr("tabIndex",0),a(this).parent("li").next("li").find("a").first().focus());else if(27==b.keyCode||37==b.keyCode)b.preventDefault(),hideMyStartBarMenu();else if(32==b.keyCode)b.preventDefault(),window.location=a(this).attr("href");else{var c=!1;a(this).parent("div").nextAll("li").find("a").each(function(){if(a(this).text().substring(0,1).toLowerCase()==keyCodeMap[b.keyCode])return a(this).focus(),c=!0,!1}),c||a(this).parent("div").prevAll("li").find("a").each(function(){if(a(this).text().substring(0,1).toLowerCase()==keyCodeMap[b.keyCode])return a(this).focus(),!1})}})}function h(a,b,c){var d;if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}else d="";document.cookie=escape(a)+"="+escape(b)+d+"; path=/"}function i(a){for(var b=escape(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return unescape(e.substring(b.length,e.length))}return null}var c={miniBaseDomainID:0,miniBaseModuleInstanceID:0,cache:!0,schoolListReady:function(a){}};if(b&&a.extend(c,b),1==c.cache&&"undefined"!=typeof Storage&&sessionStorage.getItem("cs-school-list-data"))c.schoolListReady.call(this,JSON.parse(sessionStorage.getItem("cs-school-list-data"))),g();else if(a("#swlogin").length&&location.protocol.indexOf("https")>-1){var d=location.protocol+"//"+window.location.hostname;a.ajax({type:"POST",url:d+"/GlobalAssets/Proxies/ServiceProxy.aspx/CallService",data:"{BaseURL: '"+d+"/site/default.aspx', InvokeMethod: 'GET', ServiceMethod: '', ServiceParameters: '?PageType=12&DomainId="+c.miniBaseDomainID+"&ModuleinstanceId="+c.miniBaseModuleInstanceID+"', ConnectionType: '', RequestBody: ''}",async:!0,contentType:"application/json; charset=utf-8",dataType:"json",cache:!1,success:function(b){var d=JSON.parse(b.d),e=d.data.replace(/\n|\r/g,""),j=e.indexOf('<div id="module-content-'+c.miniBaseModuleInstanceID),k=e.indexOf("<!-- End Centricity Content Area -->")-6,l=e.substring(j,k);a("#swlogin").append('<div id="school-list-minibase" style="display: none;">'+l+"</div>");var m=f("#school-list-minibase");c.schoolListReady.call(this,m),g(),i("CreativeRedirectTo")?SetCookie("RedirectTo",i("CreativeRedirectTo")):SetCookie("RedirectTo",window.location.href),-1===window.location.href.indexOf("PageType=8")&&h("CreativeRedirectTo",window.location.href)}})}else a.ajax({type:"GET",url:"/site/default.aspx?PageType=12&DomainId="+c.miniBaseDomainID+"&ModuleinstanceId="+c.miniBaseModuleInstanceID,cache:!1,success:function(a){var b=f(a);e()&&1==c.cache&&sessionStorage.setItem("cs-school-list-data",JSON.stringify(b)),c.schoolListReady.call(this,b),g(),i("CreativeRedirectTo")?SetCookie("RedirectTo",i("CreativeRedirectTo")):SetCookie("RedirectTo",window.location.href),-1===window.location.href.indexOf("PageType=8")&&h("CreativeRedirectTo",window.location.href)}})}}(jQuery);